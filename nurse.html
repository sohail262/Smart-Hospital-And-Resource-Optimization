<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nurse Dashboard - Smart Hospital Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="ri-heart-pulse-line text-2xl text-pink-600 mr-3"></i>
                        <span class="text-xl font-semibold text-gray-900">Nurse Dashboard</span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <i class="ri-user-heart-line text-gray-400"></i>
                        <span class="text-sm text-gray-700" id="nurseName">Nurse Johnson</span>
                    </div>
                    <button onclick="signOut()" class="text-gray-400 hover:text-gray-600">
                        <i class="ri-logout-box-r-line text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-pink-100 text-pink-600">
                        <i class="ri-user-heart-line text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Assigned Patients</p>
                        <p class="text-2xl font-semibold text-gray-900" id="assignedPatients">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                        <i class="ri-heart-pulse-line text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Vitals Recorded</p>
                        <p class="text-2xl font-semibold text-gray-900" id="vitalsRecorded">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-orange-100 text-orange-600">
                        <i class="ri-alarm-warning-line text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Critical Alerts</p>
                        <p class="text-2xl font-semibold text-gray-900" id="criticalAlerts">0</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-green-100 text-green-600">
                        <i class="ri-medicine-bottle-line text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-600">Medications Given</p>
                        <p class="text-2xl font-semibold text-gray-900" id="medicationsGiven">0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="bg-white rounded-lg shadow mb-6 p-6">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Quick Actions</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <button onclick="openRecordVitalsModal()" 
                    class="flex items-center justify-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition">
                    <div class="text-center">
                        <i class="ri-heart-pulse-line text-2xl text-blue-600 mb-2"></i>
                        <p class="text-sm font-medium text-gray-700">Record Vitals</p>
                    </div>
                </button>
                <button onclick="openMedicationLogModal()" 
                    class="flex items-center justify-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition">
                    <div class="text-center">
                        <i class="ri-medicine-bottle-line text-2xl text-green-600 mb-2"></i>
                        <p class="text-sm font-medium text-gray-700">Log Medication</p>
                    </div>
                </button>
                <button onclick="openCareNotesModal()" 
                    class="flex items-center justify-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-purple-500 hover:bg-purple-50 transition">
                    <div class="text-center">
                        <i class="ri-file-text-line text-2xl text-purple-600 mb-2"></i>
                        <p class="text-sm font-medium text-gray-700">Care Notes</p>
                    </div>
                </button>
                <button onclick="getAICareRecommendations()" 
                    class="flex items-center justify-center p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-indigo-500 hover:bg-indigo-50 transition">
                    <div class="text-center">
                        <i class="ri-robot-line text-2xl text-indigo-600 mb-2"></i>
                        <p class="text-sm font-medium text-gray-700">AI Care Tips</p>
                    </div>
                </button>
            </div>
        </div>

        <!-- Filters and Patient List -->
        <div class="bg-white rounded-lg shadow mb-6">
            <div class="px-6 py-4 border-b border-gray-200">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0">
                    <h2 class="text-lg font-medium text-gray-900">Patient Care List</h2>
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                        <div class="flex space-x-2">
                            <select id="wardFilter" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-pink-500">
                                <option value="">All Wards</option>
                            </select>
                            <select id="statusFilter" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-pink-500">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="critical">Critical</option>
                                <option value="stable">Stable</option>
                            </select>
                        </div>
                        <div class="relative">
                            <input type="text" id="patientSearch" placeholder="Search patients..." 
                                class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-pink-500">
                            <i class="ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Patient Cards View -->
            <div id="patientCardsContainer" class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="patientCards">
                    <!-- Patient cards will be inserted here -->
                </div>
            </div>

            <!-- Pagination -->
            <div class="bg-white px-6 py-3 border-t border-gray-200">
                <div class="flex items-center justify-between">
                    <div class="text-sm text-gray-700">
                        Showing <span id="showingStart">1</span> to <span id="showingEnd">10</span> of <span id="totalRecords">0</span> patients
                    </div>
                    <div class="flex space-x-2">
                        <button id="prevBtn" onclick="previousPage()" 
                            class="px-3 py-1 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                            Previous
                        </button>
                        <button id="nextBtn" onclick="nextPage()" 
                            class="px-3 py-1 border border-gray-300 rounded text-sm hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                            Next
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Record Vitals Modal -->
    <div id="recordVitalsModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-2xl w-full">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-800">Record Vital Signs</h3>
                        <button onclick="closeRecordVitalsModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="ri-close-line text-xl"></i>
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <form id="recordVitalsForm" class="space-y-4">
                        <input type="hidden" id="vitalsPatientId">
                        
                        <!-- Patient Selection -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Select Patient</label>
                            <select id="vitalsPatientSelect" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500">
                                <option value="">Choose a patient...</option>
                            </select>
                        </div>

                        <!-- Vital Signs -->
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Blood Pressure</label>
                                <input type="text" id="vitalsBP" placeholder="120/80" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Heart Rate (bpm)</label>
                                <input type="number" id="vitalsHR" placeholder="72" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Temperature (°C)</label>
                                <input type="number" step="0.1" id="vitalsTemp" placeholder="36.5" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">O₂ Saturation (%)</label>
                                <input type="number" id="vitalsO2" placeholder="98" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Respiratory Rate</label>
                                <input type="number" id="vitalsRR" placeholder="16" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Pain Level (0-10)</label>
                                <input type="number" min="0" max="10" id="vitalsPain" placeholder="0"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500">
                            </div>
                        </div>

                        <!-- Notes -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nursing Notes</label>
                            <textarea id="vitalsNotes" rows="3"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500"
                                placeholder="Patient condition, observations, concerns..."></textarea>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex justify-end space-x-3 pt-4 border-t">
                            <button type="button" onclick="closeRecordVitalsModal()" 
                                class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                Cancel
                            </button>
                            <button type="submit" 
                                class="px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700">
                                <i class="ri-save-line mr-2"></i>Record Vitals
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Medication Log Modal -->
    <div id="medicationLogModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-2xl w-full">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-800">Log Medication Administration</h3>
                        <button onclick="closeMedicationLogModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="ri-close-line text-xl"></i>
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <form id="medicationLogForm" class="space-y-4">
                        <input type="hidden" id="medPatientId">
                        
                        <!-- Patient Selection -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Select Patient</label>
                            <select id="medPatientSelect" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                <option value="">Choose a patient...</option>
                            </select>
                        </div>

                        <!-- Medication Details -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Medication Name</label>
                                <input type="text" id="medicationName" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                    placeholder="e.g., Paracetamol">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Dosage</label>
                                <input type="text" id="medicationDosage" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                    placeholder="e.g., 500mg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Route</label>
                                <select id="medicationRoute" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                    <option value="">Select route...</option>
                                    <option value="oral">Oral</option>
                                    <option value="iv">Intravenous (IV)</option>
                                    <option value="im">Intramuscular (IM)</option>
                                    <option value="sc">Subcutaneous (SC)</option>
                                    <option value="topical">Topical</option>
                                    <option value="inhalation">Inhalation</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Time Given</label>
                                <input type="datetime-local" id="medicationTime" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                            </div>
                        </div>

                        <!-- Notes -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Administration Notes</label>
                            <textarea id="medicationNotes" rows="3"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                placeholder="Patient reaction, side effects, administration details..."></textarea>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex justify-end space-x-3 pt-4 border-t">
                            <button type="button" onclick="closeMedicationLogModal()" 
                                class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                Cancel
                            </button>
                            <button type="submit" 
                                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                <i class="ri-save-line mr-2"></i>Log Medication
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Care Notes Modal -->
    <div id="careNotesModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-2xl w-full">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-800">Add Care Notes</h3>
                        <button onclick="closeCareNotesModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="ri-close-line text-xl"></i>
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <form id="careNotesForm" class="space-y-4">
                        <input type="hidden" id="careNotesPatientId">
                        
                        <!-- Patient Selection -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Select Patient</label>
                            <select id="careNotesPatientSelect" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option value="">Choose a patient...</option>
                            </select>
                        </div>

                        <!-- Note Type -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Note Type</label>
                            <select id="noteType" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option value="">Select type...</option>
                                <option value="general">General Care</option>
                                <option value="assessment">Patient Assessment</option>
                                <option value="medication">Medication Response</option>
                                <option value="mobility">Mobility/Activity</option>
                                <option value="nutrition">Nutrition/Hydration</option>
                                <option value="comfort">Comfort Measures</option>
                                <option value="family">Family Communication</option>
                                <option value="discharge">Discharge Planning</option>
                            </select>
                        </div>

                        <!-- Care Notes -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Care Notes</label>
                            <textarea id="careNotesText" rows="6" required
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                                placeholder="Detailed nursing observations, patient interactions, care provided, patient response..."></textarea>
                        </div>

                        <!-- Priority Level -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Priority Level</label>
                            <select id="notePriority"
                                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option value="normal">Normal</option>
                                <option value="important">Important</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex justify-end space-x-3 pt-4 border-t">
                            <button type="button" onclick="closeCareNotesModal()" 
                                class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                                Cancel
                            </button>
                            <button type="submit" 
                                class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                                <i class="ri-save-line mr-2"></i>Save Notes
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Patient Details Modal -->
    <div id="patientDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-800">Patient Care Details</h3>
                        <button onclick="closePatientDetailsModal()" class="text-gray-400 hover:text-gray-600">
                            <i class="ri-close-line text-xl"></i>
                        </button>
                    </div>
                </div>
                <div id="patientDetailsContent" class="p-6">
                    <!-- Patient details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="firebase-config.js"></script>
    <script src="js/gemini-ai.js"></script>
    <script src="js/nurse.js"></script>
</body>
</html>
